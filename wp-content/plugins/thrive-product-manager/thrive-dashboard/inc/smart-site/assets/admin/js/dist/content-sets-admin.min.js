(()=>{var t,e={2461:(t,e,i)=>{t.exports=Backbone.Collection.extend({model:i(9704),isCompleted:function(){let t=!0;return 0===this.length?t=!1:this.each((e=>{e.isCompleted()||(t=!1)})),t}})},2257:(t,e,i)=>{t.exports=Backbone.Collection.extend({model:i(7544),offset:0,limit:8,currentPage:1,_filter:{},hasFilters:function(){return Object.keys(this._filter).length>0},resetFilters:function(){return this.currentPage=1,this.offset=0,this._filter={},this},applyFilters:function(t,e){return this.currentPage=1,this.offset=0,this._filter[t]=e,this},next:function(){return this.currentPage++,this.offset=(this.currentPage-1)*this.limit,this},prev:function(){return this.currentPage--,this.offset=(this.currentPage-1)*this.limit,this},pageInfo:function(){const t=this.length;return{currentPage:this.currentPage,totalPages:Math.ceil(t/this.limit),page:this.currentPage,prev:this.offset>0,next:this.currentPage*this.limit<t}},paginated:function(){const t=this.currentPage-1,e=[];let i=this.clone();if(this.hasFilters()&&this._filter.search&&this._filter.search.length>0){i.each((t=>{-1===t.get("post_title").toLowerCase().indexOf(this._filter.search)&&e.push(t)}));for(let t in e)i.remove(e[t])}return i=_(i.rest(this.limit*t)),i=_(i.first(this.limit)),i}})},3591:t=>{t.exports=Backbone.Model.extend({sync:function(t,e,i){const s=i.beforeSend;return i.beforeSend=function(t){t.setRequestHeader("X-WP-Nonce",TD_SETS.nonce),"function"==typeof s&&s.apply(this,arguments)},Backbone.Model.prototype.sync.apply(this,arguments)},buildUrl:function(t,e={},i=""){const s=new URL(t);return _.each(e,((t,e)=>{s.searchParams.append(e,t)})),i&&(t.includes("?rest_route")?s.searchParams.set("rest_route",s.searchParams.get("rest_route")+i):s.pathname+=i),s.toString()},validation_error:function(t,e){return{field:t,message:e}},getValidationError:function(){return this.validationError&&this.validationError[0]?this.validationError[0].message:""}})},9704:(t,e,i)=>{t.exports=i(3591).extend({idAttribute:"ID",defaults:function(){return{content_type:"",content:"",field:"",operator:"",value:[],content_label:{singular:"",plural:""}}},orderSteps:["content","field","operator","value"],getSteps:function(){return this.orderSteps},getValues:function(){let t=[];return Array.isArray(this.get("value"))&&this.get("value").forEach((e=>{"object"==typeof e&&void 0!==e.id&&t.push(e.id)})),t},isCompleted:function(){let t=!0;return this.orderSteps.some((e=>!(!this.get("field")||-1!==parseInt(this.get("field")))||(0===this.get(e).length?(t=!1,!0):void 0))),t},isEmpty:function(){let t=!0;return this.orderSteps.some((e=>{if(this.get(e).length>0)return t=!1,!0})),t},normalize:function(){return new Promise((t=>{wp.apiRequest({type:"POST",url:`${TD_SETS.routes.base}/normalize-rule`,data:this.toJSON()}).always((e=>t(e)))}))}})},7544:(t,e,i)=>{const s=i(2461);t.exports=i(3591).extend({idAttribute:"ID",allowEmptyRules:!1,defaults:function(){return{post_title:"",post_content:new s}},initialize:function(t={}){t.post_content instanceof Backbone.Collection&&(t.post_content=jQuery.extend(!0,[],t.post_content.toJSON())),t.post_content&&this.set("post_content",new s(t.post_content))},parse:function(t){return t.post_content instanceof Backbone.Collection&&(t.post_content=jQuery.extend(!0,[],t.post_content.toJSON())),t.post_content&&(this.get("post_content").reset(t.post_content),t=[]),t},url:function(t="",e={}){return this.buildUrl([TD_SETS.routes.base,this.get("ID"),t].filter((t=>t)).join("/"),e)},getRules:function(){return this.get("post_content")},validate:function(t={}){const e=[];if(t.post_title||e.push(this.validation_error("post_title","Title is empty!")),!1!==this.allowEmptyRules||t.post_content.isCompleted()||e.push(this.validation_error("post_content","You must add some content")),e.length)return e}})},9131:t=>{function e(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function i(t){for(var i=1;i<arguments.length;i++){var n=null!=arguments[i]?arguments[i]:{};i%2?e(Object(n),!0).forEach((function(e){s(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):e(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function s(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}var n;n=jQuery,t.exports=Backbone.View.extend({events:{"click .click":"_call","change .change":"_call","input .input":"_call"},initialize:function(t){n.extend(!0,this,t),t&&t.template&&(this.template=t.template),this.afterInitialize(t)},_call:function(t){const e=t.currentTarget.dataset.fn;if("function"==typeof this[e])return this[e].call(this,t,t.currentTarget)},render:function(){return"string"==typeof this.template&&(this.template=TVE_Dash.tpl(this.template)),"function"==typeof this.template&&this.$el.html(this.template({model:this.model})),this.afterRender(),this},openModal:function(t,e={}){if(t.prototype instanceof TVE_Dash.views.Modal)return e=i(i({},{"max-width":"calc(100% - 40px)",width:"850px",in_duration:200,out_duration:300,className:"tvd-modal tva-modal-create",dismissible:!0}),e),TVE_Dash.modal(t,e);console.warn("Invalid type of modal view")},destroy:function(){return this.stopListening(),this.undelegateEvents(),this.$el.removeData().off(),this},afterRender:n.noop,afterInitialize:n.noop})},4999:(t,e,i)=>{t.exports=i(9131).extend({cancel:function(){this.remove()},confirm:function(){this.remove()}})},8290:(t,e,i)=>{t.exports=i(9131).extend({template:"",className:"tvd-content-set-rule-step",afterInitialize:function(t){this.ruleModel=t.ruleModel,this.step=t.step},hasStoredValue:function(){return this.getStoredValue().length>0},getStoredValue:function(){return this.ruleModel.get(this.step)},isValid:function(t){return t&&t.trim().length>0},change:function(t,e){this.isValid(e.value)&&this.ruleModel.trigger("control-changed",this.step,this.processValue(e.value))},processValue:function(t){return t}})},6849:(t,e,i)=>{t.exports=i(8290).extend({template:"tvd-c-s-date-picker",afterRender:function(){this.$input=this.$(".tvd-date-picker"),this.$input.pickadate({firstDay:1,format:"dd-mmm-yyyy",formatSubmit:"yyyy-mm-dd",hiddenName:!0}),this.picker=this.$input.pickadate("picker"),this.hasStoredValue()&&this.$input.val(this.processFormat())},processFormat:function(){const t=new Date(this.getStoredValue()),e=parseInt(t.getMonth())+1,i=t.getFullYear(),s=e<10?"0"+e:e;return(t.getDate()<10?"0"+t.getDate():t.getDate())+"-"+s+"-"+i},processValue:function(t){return this.picker.get("select","yyyy-mm-dd")}})},6428:(t,e,i)=>{function s(t,e){var i=Object.keys(t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(t);e&&(s=s.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),i.push.apply(i,s)}return i}function n(t){for(var e=1;e<arguments.length;e++){var i=null!=arguments[e]?arguments[e]:{};e%2?s(Object(i),!0).forEach((function(e){o(t,e,i[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):s(Object(i)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(i,e))}))}return t}function o(t,e,i){return(e=function(t){var e=function(t){if("object"!=typeof t||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var i=e.call(t,"string");if("object"!=typeof i)return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==typeof e?e:e+""}(e))in t?Object.defineProperty(t,e,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[e]=i,t}t.exports=i(8290).extend({template:"tvd-c-s-select-multiple",afterRender:function(){this.$select=this.$("select"),this.$select.data("select2")&&this.$select.select2("destroy");const t=this.ruleModel;this.$select.select2({placeholder:"Search for content",minimumInputLength:2,delay:250,multiple:!0,tags:!1,ajax:{url:TD_SETS.routes.base,type:"GET",dataType:"json",data:function(e){return n(n({},t.toJSON()),{_wpnonce:TD_SETS.nonce,query_string:e.term})},delay:250,cache:!0,processResults:function(t){return{results:t}}}}),this.hasStoredValue()&&this.setSelected(this.getStoredValue()),this.$select.data("select2").$container.addClass("tvd-content-set-select-multiple"),this.$select.on("select2:select",(t=>{this.change()})).on("select2:unselect",(t=>{t.params.originalEvent&&(t.params.originalEvent.stopPropagation(),this.change())})).data("select2").$dropdown.addClass("tvd-content-set-delete-select-multiple-dropdown")},setSelected:function(t){const e=[];this.$select.empty(),(t=t.filter((t=>t))).forEach((t=>{e.push(t.id),this.$select.append('<option value="'+t.id+'">'+t.text+"</option>")})),this.$select.val(e).trigger("change")},change:function(t,e){const i=[];this.$select.select2("data").forEach((t=>{i.push({id:t.id,text:t.text})})),this.ruleModel.trigger("control-changed",this.step,i)}})},403:(t,e,i)=>{t.exports=i(8290).extend({template:"tvd-c-s-select",afterRender:function(){this.$select=this.$("select"),this.model.get("options").forEach((t=>{const e=`<option value="${t.value}"${t.disabled?" disabled selected":""}>${t.label}</option>`;this.$select.append(e)})),this.hasStoredValue()&&this.setSelected(this.getStoredValue()),this.model.get("trigger_change")&&(this.setSelected(this.getFirstOptionValue()),setTimeout((()=>{this.triggerChange()}))),this.$select.select2({minimumResultsForSearch:-1,width:"100%"}),this.$select.data("select2").$container.addClass("tvd-content-set-select-simple"),this.$select.data("select2").$dropdown.addClass("tvd-content-set-select-dropdown")},setSelected:function(t){t&&this.$select.find(`option[value="${t}"]`).attr("selected","selected")},getFirstOptionValue:function(){return this.$select.find("option:eq(1)").val()},triggerChange:function(){this.$select.trigger("change")},isValid:function(){return!0}})},3587:(t,e,i)=>{t.exports=i(8290).extend({template:"tvd-c-s-within-the-last",afterRender:function(){if(this.$input=this.$("input"),this.$select=this.$("select"),this.hasStoredValue()){const t=this.getStoredValue().split(" ");this.$input.val(t[0].trim()),this.$select.val(t[1].trim())}else this.$input.val(0),this.$select.val(this.$select.find("option").first().attr("value"));this.$select.select2(),this.$select.data("select2").$container.addClass("mt-10 tvd-content-set-select-simple"),this.$select.data("select2").$dropdown.addClass("tvd-content-set-select-dropdown")},isValid:function(){const t=this.$input.val();return isNaN(t)||parseInt(t)<0?(this.$input.val(1),!1):Number.isInteger(parseInt(this.$input.val()))&&this.$select.val().length>0},change:function(t,e){if(this.isValid(e.value)){const t={};t[this.step]=this.processValue(e.value),this.ruleModel.set(t)}},processValue:function(t){return`${this.$input.val()} ${this.$select.val()}`}})},6808:(t,e,i)=>{t.exports=i(9131).extend({template:"form",addNewRuleTemplate:"add-new-rule",addRuleView:null,afterInitialize:function(){this.listenTo(this.model.getRules(),"add remove change",_.bind(this.rulesChanged,this)),this.listenTo(this.model.getRules(),"add change",this.animateToBottom)},afterRender:function(){this.$name=this.$("#tvd-content-set-name"),this.$rulesWrapper=this.$("#tvd-content-set-rules"),this.$addRuleWrapper=this.$("#tvd-content-set-add-rule"),this.$inner=this.$(".tvd-content-set-inner"),this.$saveButton=this.$("button"),this.renderRules(),this.rulesChanged(),this.$name.on("input",(()=>{this.getTitle().length>=1&&this.$name.removeClass("tva-cset-error")}))},renderRules:function(){this.$rulesWrapper.empty(),this.model.getRules().each(this.renderRule,this)},renderRule:function(t){this.$rulesWrapper.append(new TD_SETS.Views.Rule({model:t,collection:this.model.getRules()}).render().$el)},rulesChanged:function(){this.$addRuleWrapper.children().remove(),this.allowAddNewRule()&&this.$addRuleWrapper.append(TVE_Dash.tpl(this.addNewRuleTemplate)())},animateToBottom:function(){this.$inner.animate({scrollTop:this.$inner[0].scrollTop+1e3},150)},addNewRule:function(){const t=new TD_SETS.Models.Rule({});this.model.getRules().add(t),this.renderRule(t)},allowAddNewRule:function(){let t=!0;return this.model.getRules().each((e=>{e.isCompleted()||(t=!1)})),t},getTitle:function(){return this.$name.val().trim()},saveContentSet:function(){const t=this.getTitle();if(this.$(".tva-cset-error").removeClass("tva-cset-error"),this.$name.toggleClass("tva-cset-error",0===t.length),0===t.length)return setTimeout((()=>{this.$inner.animate({scrollTop:0},150)}),200),void TVE_Dash.err("Please add a name");if(this.model.set({post_title:t},{silent:!0}),!this.model.isValid()){const t=this.model.changedAttributes();if(t&&t.post_title){const t=this.model.previousAttributes();this.model.set({post_title:t.post_title},{silent:!0})}return TVE_Dash.err(this.model.getValidationError()),void this.$("input, select").each(((t,e)=>{"input"===e.tagName.toLowerCase()&&e.classList.contains("select2-search__field")?0===jQuery(e).closest(".tvd-content-set-rule-step").find("select").val().length&&e.classList.add("tva-cset-error"):e.value||e.classList.add("tva-cset-error")}))}this.$saveButton.addClass("disabled"),TVE_Dash.showLoader(),this.model.save().done((t=>{this.collection.reset(t),this.$saveButton.removeClass("disabled"),TVE_Dash.hideLoader()})).fail((t=>{t.responseJSON&&t.responseJSON.message?TVE_Dash.err("Something went wrong: "+t.responseJSON.message):TVE_Dash.err("Something went wrong: "+t.responseText),this.$saveButton.removeClass("disabled"),TVE_Dash.hideLoader()}))}})},8581:(t,e,i)=>{t.exports=i(9131).extend({className:"tvd-content-set-item",template:"item",edit:function(){this.openModal(TD_SETS.Views.Modals.Edit,{model:this.model,collection:this.collection,width:"810px",className:"tvd-modal tvd-content-set-edit"})},delete:function(){const t=new TD_SETS.Views.Confirm({template:TVE_Dash.tpl("item-delete-confirmation"),className:"tvd-content-set-delete-confirmation",confirm:()=>{this.model.destroy({wait:!0,success:(t,e)=>{this.destroy().remove()}})},cancel:function(){this.remove()}});this.$el.append(t.render().$el)}})},9230:(t,e,i)=>{t.exports=i(9131).extend({template:"list",noItemsTemplate:"tva-c-s-no-items",noSearchItemsTemplate:"tva-c-s-no-search-items",pagination:null,itemViews:{},afterInitialize:function(){this.listenTo(this.collection,"reset",_.bind(this.renderList,this)),this.listenTo(this.collection,"page-changed",_.bind(this.renderList,this)),this.listenTo(this.collection,"remove",_.bind((()=>{this.collection.pageInfo().currentPage>1&&0===this.collection.paginated().toJSON().length&&this.collection.prev(),this.renderList(),this.pagination.render()}),this))},afterRender:function(){this.$list=this.$(".tvd-content-sets-list"),this.$pagination=this.$(".tvd-content-sets-list-pagination"),this.renderList(),this.renderPagination()},renderPagination:function(){this.pagination=new TD_SETS.Views.Pagination({el:this.$pagination,collection:this.collection}),this.pagination.render()},filterSets:function(t,e){e.value.length?this.collection.applyFilters("search",e.value):this.collection.resetFilters(),this.renderList(),this.pagination.toggle(!this.collection.hasFilters()).render()},renderList:function(){if(this.$list.empty(),this.itemViews={},0===this.collection.length)return this.$list.html(TVE_Dash.tpl(this.noItemsTemplate));const t=this.collection.paginated();if(this.collection.hasFilters()&&0===t.size())return this.$list.html(TVE_Dash.tpl(this.noSearchItemsTemplate));t.forEach(this.renderItem,this)},renderItem:function(t){const e=new TD_SETS.Views.Item({model:t,collection:this.collection});this.$list.append(e.render().$el),this.itemViews[t.get("ID")]=e},addSet:function(){this.openModal(TD_SETS.Views.Modals.Edit,{model:new TD_SETS.Models.Set({}),collection:this.collection,width:"810px",className:"tvd-modal tvd-content-set-edit"})}})},6082:t=>{jQuery,t.exports=TVE_Dash.views.Modal.extend({template:"",events:{"click .click":"_call","input .input":"_call","keyup .keyup":"_call","change .change":"_call"},_call:function(t){const e=t.currentTarget.dataset.fn;if("function"==typeof this[e])return this[e].call(this,t,t.currentTarget)},afterRender:function(){return this}})},1463:(t,e,i)=>{t.exports=i(6082).extend({template:"modals/edit",afterInitialize:function(){this.listenTo(this.collection,"reset",_.bind(this.close,this))},afterRender:function(){this.$_content=this.$el,this.$(".tvd-content-set-form").html(new TD_SETS.Views.Form({model:this.model,collection:this.collection}).render().$el)}})},5846:(t,e,i)=>{t.exports=i(9131).extend({template:"tva-c-s-pagination",afterInitialize:function(){this.listenTo(this.collection,"reset",this.render),this.listenTo(this.collection,"page-changed",this.render)},toggle:function(t){return this.$el.toggle(!!t),this},render:function(){const t=this.collection.pageInfo();this.$el.html(t.totalPages>1?TVE_Dash.tpl(this.template)(t):"")},previousPage:function(){this.collection.prev().trigger("page-changed")},nextPage:function(){this.collection.next().trigger("page-changed")}})},3100:(t,e,i)=>{t.exports=i(9131).extend({template:"rule",className:"tvd-content-set-rule",hiddenPostTypes:["tvd_blog_page","tvd_search_result_page"],afterInitialize:function(){this.listenTo(this.model,"control-changed",_.bind(this.stepChanged,this)),this.listenTo(this.collection,"add",_.bind(this.allowDelete,this)),this.listenTo(this.collection,"remove",_.bind(this.allowDelete,this))},clearSteps:function(){this.stepInstances&&this.stepInstances.forEach((t=>{t.off("all"),t.destroy()})),this.stepInstances=[]},afterRender:function(){this.$ruleWrapper=this.$(".tvd-rule-holder").empty(),this.$deleteRuleWrapper=this.$(".tvd-content-set-delete-rule-wrapper"),this.clearSteps(),this.model.isEmpty()||this.model.getSteps().forEach((t=>{this.model.get(t).length>0&&this.addStep(t)})),this.computeNextStep(),this.allowDelete()},stepChanged:function(t,e){this.clearSteps(),this.$ruleWrapper.empty();const i=this.getStepIndex(t)+1;if(this.getStepsLength()!==i)for(let t=i;t<this.getStepsLength();t++){const e=this.model.getSteps()[t];if(this.model.get(e).toString().length){const t={};t[e]="",this.model.set(t,{silent:!0})}}this.model.set(this.getRuleModelParams(t,e)),this.model.getSteps().forEach((t=>{this.model.get(t).length>0&&this.addStep(t)})),this.computeNextStep("field"===t&&this.getNextStep().length)},getRuleModelParams:function(t,e){const i={};return i[t]=e,"content"===t&&(["tvd_search_result_page","tvd_blog_page"].includes(i.content)?(i.content_type=i.content,i.field=-1):"archive"===i.content?i.content_type=i.content:i.content_type=TD_SETS.post_types.includes(e)?"post":"term"),"field"===t&&("title"===i.field&&"archive"===this.model.get("content_type")&&(i.content_type="term",i.content="category"),"author"===i.field&&["archive","term"].includes(this.model.get("content_type"))&&(i.content_type="archive",i.content="archive")),i},computeNextStep:function(t=!1){this.getNextStep().length&&this.addStep(this.getNextStep(),t)},getStepIndex:function(t){return this.model.getSteps().indexOf(t)},getStepsLength:function(){return this.model.getSteps().length},getNextStep:function(){let t="";return this.forceCompleteSteps()||this.model.getSteps().some((e=>{if(0===this.model.get(e).length)return t=e,!0})),t},forceCompleteSteps:function(){return this.model.get("field")&&-1===parseInt(this.model.get("field"))||this.hiddenPostTypes.includes(this.model.get("content"))},addStep:function(t,e=!1){const i=new(this.getStepView(t))({ruleModel:this.model,step:t,model:new Backbone.Model({options:this.getStepOptions(t),trigger_change:e})});"content"===t&&"category"===this.model.get("content")&&(i.getStoredValue=function(){return"term"===this.ruleModel.get("content_type")&&"category"===this.ruleModel.get("content")?"archive":this.ruleModel.get(this.step)}),this.stepInstances.push(i),this.$ruleWrapper.append(i.render().$el)},getStepOptions:function(t){let e=TD_SETS.options.general[t];return"field"===t&&Array.isArray(TD_SETS.options.exceptions[this.model.get("content")])?e=TD_SETS.options.exceptions[this.model.get("content")]:"operator"===t&&Array.isArray(TD_SETS.options.exceptions[this.model.get("field")])&&(e=TD_SETS.options.exceptions[this.model.get("field")]),e},getStepView:function(t){let e=i(9131);switch(t){case"content":case"field":case"operator":e=i(403);break;case"value":e=this.model.get("field")===TD_SETS.fields.published_date?this.model.get("operator")===TD_SETS.operators.within_last?i(3587):i(6849):i(6428)}return e},allowDelete:function(){this.$deleteRuleWrapper.toggle(this.collection.length>1)},deleteRule:function(){const t=new TD_SETS.Views.Confirm({template:TVE_Dash.tpl("rule-delete-confirmation"),className:"tvd-content-set-delete-confirmation",confirm:()=>{this.model.destroy(),this.destroy().remove()},cancel:function(){this.remove()}});this.$el.append(t.render().$el)}})}},i={};function s(t){var n=i[t];if(void 0!==n)return n.exports;var o=i[t]={exports:{}};return e[t](o,o.exports,s),o.exports}(t=jQuery).extend(TD_SETS,{Models:{Set:s(7544),Rule:s(9704)},Collections:{Sets:s(2257),Rules:s(2461)},Views:{List:s(9230),Item:s(8581),Rule:s(3100),Form:s(6808),Pagination:s(5846),Confirm:s(4999),Modals:{Edit:s(1463)},Controls:{Base:s(8290)}}}),t(window).trigger("td_sets_ready",TD_SETS),TD_SETS.sets=new TD_SETS.Collections.Sets(TD_SETS.sets)})();